<%- include page/header %>
		<div class="row">
		<div class="col-md-12 column">
			<form method = "post" id="unitList" name="unitList">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>
								項目
							</th>
							<th>
								名稱
							</th>
							<th>
								MAC
							</th>
							<th>
								狀態
							</th>
							<th>
								時間
							</th>
							</th>

						</tr>
					</thead>
					<tbody>
						<% if (units) { %>
							<% for(var i = 0;i<units.length;i++) { %>
								<tr>
									<td>
										<%= (i+1) %>
									</td>
									<td>
										<input name="myName" type="text" value="<%= units[i].name %>">
									</td>
									<td>
										<input name="myMac" type="text" disabled="disabled" value="<%= units[i].macAddr %>">

									</td>
									<td>
										<% if(units[i].status == 0){ %>
											<img src="/images/btn_normal.png" width="80" height="30" name="status">
										<% }else if(units[i].status == 1){ %>
											<img src="/images/btn_alarm.png" width="80" height="30" name="status">
										<% }else if(units[i].status == 2){ %>
											<img src="/images/btn_loss.png" width="80" height="30" name="status">
										<% } %>
									</td>
									<td>
										<%= units[i].update_at.date %>
									</td>
									<td>
										<button type="button" name="edit" class="btn btn-primary btn-sm" onClick="editCheck(this)">
											<span class="glyphicon glyphicon-edit"></span> 編輯
										</button>
										<button type="button" name="del" class="btn btn-danger btn-sm" onClick="delCheck(this)">
											<span class="glyphicon glyphicon-trash"></span> 刪除
										</button>

									</td>
								</tr>
							<% } %>
						<% } %>
					</tbody>
				</table>
				<input id="postMac" name="postMac" type="hidden"">
				<input id="postName" name="postName" type="hidden"">
			</form>

		</div> <!-- column-->
	</div>	<!--row-->

<!-- （Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
   aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title" id="myModalLabel">
               刪除裝置警告
            </h4>
         </div>
         <div class="modal-body">
            確定刪除裝置嗎?
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-default"
               data-dismiss="modal">關閉
            </button>
            <button type="button" onClick="toSubmit()" class="btn btn-danger">
               確定刪除
            </button>
         </div>s
      </div><!-- /.modal-content -->
</div><!-- /.modal -->

	<script src="js/bootstrap-table.js"></script>

<script class="code" type="text/javascript">
	var socket = io.connect();
	socket.on('connect',function(){
        socket.emit('index_client','hello,index_client socket cient is ready');
    });

    socket.on('index_client_timeout',function(data){

		//alert('index :'+data.index);
		//alert('status :'+data.status);
		if( data.status == 0 ){
			$('[name=status]').eq(data.index).attr("src","/images/btn_normal.png");
		}else if( data.status == 1 ){
			$('[name=status]').eq(data.index).attr("src","/images/btn_alarm.png");
		}else{
			$('[name=status]').eq(data.index).attr("src","/images/btn_loss.png");
		}


	});

	function editCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");
		var postName = document.getElementById("postName");

		if(unitList.del.length>0){
			for(var i=0;i<unitList.edit.length;i++){
				if(unitList.edit[i] == button){
					index = i;
					alert(i);
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);

			postMac.value = unitList.myMac[index].value;
			postName.value = unitList.myName[index].value;
			//alert("行 :"+(index+1) + postMac.value + " "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			postName.value = unitList.myName.value;
		}

		document.getElementById("unitList").submit();
	}

	function delCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");

		if(unitList.del.length>0){
			for(var i=0;i<unitList.del.length;i++){
				if(unitList.del[i] == button){
					index = i;
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);
			postMac.value = unitList.myMac[index].value;
			//alert("行 :"+(index+1) + " mac : "+postMac.value + " name : "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			//alert(postMac.value);
		}
		$('#myModal').modal('show');
	}

	function toSubmit(){
		$('#myModal').modal('hide');
		document.getElementById("unitList").submit();
	}
</script>

<%- include page/footer %>