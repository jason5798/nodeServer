<%- include page/header %>
	<div class="row">

		<div class="col-md-8 column">
			<div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-left">
									 <div class="fa fa-2x">溫度</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">℃</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_temperature.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="temperature" class="fa fa-5x">25</div>
	                        	</span>

		                </div>
		                <!--<div class="panel-footer">
	                        <span class="pull-left">View Details</span>
	                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
	                        <div class="clearfix"></div>
	                    </div>-->
		            </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-center">
									 <div class="fa fa-2x">濕度</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">%</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_humidity.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="humidity" class="fa fa-5x">70</div>
	                        	</span>

		                </div>
		            </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-center">
									 <div class="fa fa-2x">粒子</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">µg/m³</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_pm25.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="pm25" class="fa fa-5x">150</div>
	                        	</span>

		                </div>
		            </div>
            </div>
			<div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-left">
									 <div class="fa fa-2x">紫外線</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">eV</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_uv.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="temperature" class="fa fa-5x">4</div>
	                        	</span>

		                </div>
		                <!--<div class="panel-footer">
	                        <span class="pull-left">View Details</span>
	                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
	                        <div class="clearfix"></div>
	                    </div>-->
		            </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-center">
									 <div class="fa fa-2x">CO2</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">g/cm3</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_co2.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="humidity" class="fa fa-3x">0.496</div>
	                        	</span>

		                </div>
		            </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="panel panel-primary">
		            	<div class="panel-heading">
							<span class="pull-center">
									 <div class="fa fa-2x">氣壓</div>
							</span>
							<span class="pull-right">
	                        		<div class="fa fa-2x">mb</div>
	                        </span>
						</div>
		                <div class="panel-body">

		                        <span class="pull-left">
		                        	<img src="/images/icon_pressure.png" width="80" height="80">
		                        </span>
	                        	<span class="pull-right">
	                        		 <div id="temperature" class="fa fa-4x">998</div>
	                        	</span>

		                </div>
		            </div>
            </div>
			<div class="col-md-12 column">
				<form method = "post" id="unitList" name="unitList">
					<table class="table table-striped table-hover">
						<thead>
							<tr>
								<th>
									項目
								</th>
								<th>
									名稱
								</th>
								<th>
									MAC
								</th>
								<th>
									狀態
								</th>
								<th>
									時間
								</th>
								</th>

							</tr>
						</thead>
						<tbody>
						<% if (units) { %>
							<% for(var i = 0;i<units.length;i++) { %>
								<tr>
									<td>
										<%= (i+1) %>
									</td>
									<td>
										<input name="myName" type="text" value="<%= units[i].name %>">
									</td>
									<td>
										<input name="myMac" type="text" disabled="disabled" value="<%= units[i].macAddr %>">

									</td>
									<td>
									<% if(units[i].status == 0){ %>
										<img src="/images/btn_normal.png" width="80" height="30" name="status">
									<% }else if(units[i].status == 1){ %>
										<img src="/images/btn_alarm.png" width="80" height="30" name="status">
									<% }else if(units[i].status == 2){ %>
										<img src="/images/btn_loss.png" width="80" height="30" name="status">
									<% } %>
									</td>
									<td>
										<%= units[i].update_at.date %>
									</td>
									<td>
										<% if (user.authz.a02==true) { %>
											<button type="button" name="edit" class="btn btn-primary btn-sm" onClick="editCheck(this)">
										<% }else{ %>
										    <button type="button" name="edit" class="btn btn-default btn-sm" disabled>
										<% } %>
											<span class="glyphicon glyphicon-edit"></span> 編輯
										</button>
										<% if (user.authz.a02==true) { %>
											<button type="button" name="del" class="btn btn-danger btn-sm" onClick="delCheck(this)">
										<% }else{ %>
										    <button type="button" name="del" class="btn btn-default btn-sm" disabled>
										<% } %>
											<span class="glyphicon glyphicon-trash"></span> 刪除
										</button>
									</td>
								</tr>
							<% } %>
						<% } %>
						</tbody>
					</table>
					<input id="postMac" name="postMac" type="hidden"">
					<input id="postName" name="postName" type="hidden"">
				</form>
			</div> <!-- col-md-12 column-->
		</div> <!-- col-md-8 column-->
		<div class="col-md-4 column col-centered">
			<a href="http://www.accuweather.com/en/tw/hualien-county/3369306/weather-forecast/3369306" class="aw-widget-legal">
			<!--
			By accessing and/or using this code snippet, you agree to AccuWeather’s terms and conditions (in English) which can be found at http://www.accuweather.com/en/free-weather-widgets/terms and AccuWeather’s Privacy Statement (in English) which can be found at http://www.accuweather.com/en/privacy.
			-->
			</a>
			<div id="awtd1474449223149" class="aw-widget-36hour"  data-locationkey="" data-unit="c" data-language="zh-tw" data-useip="false" data-uid="awtd1474449223149" data-editlocation="false">
			</div><!-- column-->
		</div> <!-- col-md-4 column col-centered-->
	</div>	<!--row-->
	<div class="row">
		<div class="col-md-12 column">
			<label id="error_message" class="checkbox">
	            <font color="red"><b></b>
	            <% if (user.authz.a02==false) { %>
	                你沒有權限,請通知管理員變更權限!
	            <% } %>
	        </label>
		</div> <!-- column-->
	</div>	<!--row-->


<!-- （Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
   aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title" id="myModalLabel">
               刪除裝置警告
            </h4>
         </div>
         <div class="modal-body">
            確定刪除裝置嗎?
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-default"
               data-dismiss="modal">關閉
            </button>
            <button type="button" onClick="toSubmit()" class="btn btn-danger">
               確定刪除
            </button>
         </div>
      </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->


<script class="code" type="text/javascript">
	$(document).ready(function () {
		setTimeout(function(){
		    //do what you need here
		    document.getElementById('error_message').innerText = '';
		}, 3000);
	});
	var callbackFunction = function(data) {
	    var wind = data.query.results.channel.wind;
	    //alert(wind.chill);
	};
	var socket = io.connect();
	socket.on('connect',function(){
        socket.emit('index_client','hello,index_client socket cient is ready');
    });

    socket.on('index_weather_data',function(data){

		alert('index :'+data.data);
		//alert('status :'+data.status);
	});

	function editCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");
		var postName = document.getElementById("postName");

		if(unitList.del.length>0){
			for(var i=0;i<unitList.edit.length;i++){
				if(unitList.edit[i] == button){
					index = i;
					alert(i);
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);

			postMac.value = unitList.myMac[index].value;
			postName.value = unitList.myName[index].value;
			//alert("行 :"+(index+1) + postMac.value + " "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			postName.value = unitList.myName.value;
		}

		document.getElementById("unitList").submit();
	}

	function delCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");
		//For check array is exist or not
		if(unitList.del.length>0){
			for(var i=0;i<unitList.del.length;i++){
				if(unitList.del[i] == button){
					index = i;
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);
			postMac.value = unitList.myMac[index].value;
			//alert("行 :"+(index+1) + " mac : "+postMac.value + " name : "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			//alert(postMac.value);
		}
		$('#myModal').modal('show');
	}

	function toSubmit(){
		$('#myModal').modal('hide');
		document.getElementById("unitList").submit();
	}
</script>
<script type="text/javascript" src="http://oap.accuweather.com/launch.js"></script>
<script src="https://query.yahooapis.com/v1/public/yql?q= select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='Hualien, tw') and u='c'&format=json&callback=callbackFunction"></script>
<%- include page/footer %>