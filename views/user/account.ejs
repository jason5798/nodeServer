<%- include ../page/header %>
	<div class="row">
		<div class="col-md-12 column">
			<form method = "post" id="unitList" name="unitList">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>
								帳號
							</th>
							<th>
								可用
							</th>
							<th>
								帳號資訊
							</th>
							<th>
								首頁
							</th>
							<th>
								最新訊息
							</th>
							<th>
								圖表分析
							</th>
							<th>
								資料查詢
							</th>
							<th>
								裝置設定
							</th>
							<th>
							</th>
						</tr>
					</thead>
					<tbody>
					<% if (users) { %>
						<% for(var i = 0;users.length;i++) { %>
							<tr>
								<td>
									<%= users[i].name %>
								</td>
								<td>
								    <% if(user[i].enable) { %>
										<input type="checkbox" name="data[]" value="enable" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="enable">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a01) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a02) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a03) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a04) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a05) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<% if(user[i].authz.a06) { %>
										<input type="checkbox" name="data[]" value="a01" checked>
									<% }else { %>
										<input type="checkbox" name="data[]" value="a01">
									<% } %>
								</td>
								<td>
									<button type="button" name="edit" class="btn btn-primary btn-sm" onClick="editCheck(this)">
										<span class="glyphicon glyphicon-edit"></span> 編輯
									</button>
									<button type="button" name="del" class="btn btn-danger btn-sm" onClick="refresh(user[i])">
										<span class="glyphicon glyphicon-refresh"></span> 取消
									</button>
									<button type="button" name="del" class="btn btn-danger btn-sm" onClick="delCheck(this)">
										<span class="glyphicon glyphicon-trash"></span> 刪除
									</button>
								</td>
							</tr>
						<% } %>
					<% } %>
					</tbody>
				</table>
				<input id="postMac" name="postMac" type="hidden"">
				<input id="postName" name="postName" type="hidden"">
			</form>

		</div> <!-- column-->
	</div>	<!--row-->

<!-- （Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
   aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title" id="myModalLabel">
               刪除帳戶警告
            </h4>
         </div>
         <div class="modal-body">
            確定刪除帳戶嗎?
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-default"
               data-dismiss="modal">關閉
            </button>
            <button type="button" onClick="toSubmit()" class="btn btn-danger">
               確定刪除
            </button>
         </div>s
      </div><!-- /.modal-content -->
</div><!-- /.modal -->

	<script src="js/bootstrap-table.js"></script>

<script class="code" type="text/javascript">
	var socket = io.connect();
	socket.on('connect',function(){
        socket.emit('index_client','hello,index_client socket cient is ready');
    });

    socket.on('index_client_timeout',function(data){

		//alert('index :'+data.index);
		//alert('status :'+data.status);
		if( data.status == 0 ){
			$('[name=status]').eq(data.index).attr("src","/images/btn_normal.png");
		}else if( data.status == 1 ){
			$('[name=status]').eq(data.index).attr("src","/images/btn_alarm.png");
		}else{
			$('[name=status]').eq(data.index).attr("src","/images/btn_loss.png");
		}


	});

	function editCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");
		var postName = document.getElementById("postName");

		if(unitList.del.length>0){
			for(var i=0;i<unitList.edit.length;i++){
				if(unitList.edit[i] == button){
					index = i;
					alert(i);
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);

			postMac.value = unitList.myMac[index].value;
			postName.value = unitList.myName[index].value;
			//alert("行 :"+(index+1) + postMac.value + " "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			postName.value = unitList.myName.value;
		}

		document.getElementById("unitList").submit();
	}

	function delCheck(button){

		var index = -1;
		var postMac = document.getElementById("postMac");

		if(unitList.del.length>0){
			for(var i=0;i<unitList.del.length;i++){
				if(unitList.del[i] == button){
					index = i;
					break;
				}
			}
			//alert("行 :"+(index+1) + unitList.myMac[index].value + " "+unitList.myName[index].value);
			postMac.value = unitList.myMac[index].value;
			//alert("行 :"+(index+1) + " mac : "+postMac.value + " name : "+postName.value);
		}else{
			postMac.value = unitList.myMac.value;
			//alert(postMac.value);
		}
		$('#myModal').modal('show');
	}

	function refresh(user){

		alert('user : '+user);
	}

	function toSubmit(){
		$('#myModal').modal('hide');
		document.getElementById("unitList").submit();
	}
</script>

<%- include ../page/footer %>